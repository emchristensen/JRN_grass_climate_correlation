---
title: "PDO climate correlations"
author: "Erica Christensen"
date: "10/6/2021"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(emmeans)

pdo_phases = read.csv('../data/PDO_phases_byyear.csv')
climate = read.csv('../data/climate_variables.csv')


alldata = merge(pdo_phases, climate, by.x='year', by.y='water_yr', all=T) %>%
  dplyr::filter(year>=1915, year<=2020)

```

## Correlation between PDO phase and precip, SPEI

There are predicted to be differences in precipitation patterns when the PDO is in a warm vs. cool phase.

```{r yearly precip, echo=F}
plotdata = dplyr::filter(alldata, !is.na(pdo_phase))

yearly = ggplot(plotdata, aes(x=pdo_phase, y=yearly_ppt_mm)) +
  geom_boxplot(na.rm=T) +
  geom_jitter(width=.1, alpha=.4, na.rm=T) +
  ylab('Yearly ppt (mm)') +
  xlab('') +
  theme_bw()
summer = ggplot(plotdata, aes(x=pdo_phase, y=summer_ppt_mm)) +
  geom_boxplot(na.rm=T) +
  geom_jitter(width=.1, alpha=.4, na.rm=T) +
  ylab('Summer ppt (mm)') +
  xlab('') +
  theme_bw()
winter = ggplot(plotdata, aes(x=pdo_phase, y=winter_ppt_mm)) +
  geom_boxplot(na.rm=T) +
  geom_jitter(width=.1, alpha=.4, na.rm=T) +
  ylab('Winter ppt (mm)') +
  xlab('') +
  theme_bw()
speiplot = ggplot(plotdata, aes(x=pdo_phase, y=spei)) +
  geom_boxplot(na.rm=T) +
  geom_jitter(width=.1, alpha=.4, na.rm=T)+
  ylab('SPEI') +
  xlab('') +
  theme_bw()
pdsiplot = ggplot(plotdata, aes(x=pdo_phase, y=pdsi)) +
  geom_boxplot(na.rm=T) +
  geom_jitter(width=.1, alpha=.4, na.rm=T)+
  ylab('PDSI') +
  xlab('') +
  theme_bw()
meantemp = ggplot(plotdata, aes(x=pdo_phase, y=mean_temp)) +
  geom_boxplot(na.rm=T) +
  geom_jitter(width=.1, alpha=.4, na.rm=T)+
  ylab('Mean temp (C)') +
  xlab('') +
  theme_bw()

# get summary statistics of warm and cool
summary(dplyr::filter(plotdata, pdo_phase=='warm'))
summary(dplyr::filter(plotdata, pdo_phase=='cool'))

gridExtra::grid.arrange(yearly, summer, winter, speiplot, pdsiplot, meantemp, nrow=2)


```

Are the differences significant?

```{r significance, echo=T}
# anova of grass cover by phase
yearly.aov <- aov(yearly_ppt_mm ~ pdo_phase, data=plotdata)
summary(yearly.aov)
summer.aov <- aov(summer_ppt_mm ~ pdo_phase, data=plotdata)
summary(summer.aov)
winter.aov <- aov(winter_ppt_mm ~ pdo_phase, data=plotdata)
summary(winter.aov)
spei.aov <- aov(spei ~ pdo_phase, data=plotdata)
summary(spei.aov)
pdsi.aov <- aov(pdsi ~ pdo_phase, data=plotdata)
summary(pdsi.aov)
temp.aov <- aov(mean_temp ~ pdo_phase, data=plotdata)
summary(temp.aov)


# marginal means
emmeans(yearly.aov, ~pdo_phase)
emmeans(summer.aov, ~pdo_phase)
emmeans(winter.aov, ~pdo_phase)
emmeans(spei.aov, ~pdo_phase)
emmeans(pdsi.aov, ~pdo_phase)
emmeans(temp.aov, ~pdo_phase)
```

The differences are significant for yearly, summer, and winter precip. 

