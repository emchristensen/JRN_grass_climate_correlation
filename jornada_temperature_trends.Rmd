---
title: "Jornada temperature trends"
author: "Erica Christensen"
date: "8/6/2021"
output: pdf_document
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)

# read raw files
jrn = read.csv('data/raw_climate_data/JRN_379001_NOAA_JER_HQ_daily_climate_data.csv')
noaaprcp = read.csv('data/raw_climate_data/NOAA_Jornada_precip_downloaded20210803.csv')
noaatemp = read.csv('data/raw_climate_data/NOAA_Jornada_temp.csv')
prism = read.csv('data/raw_climate_data/PRISM_ppt_tmin_tmean_tmax_tdmean_vpdmin_vpdmax_stable_4km_189501_202001_Headquarters.csv', skip=10)

# put noaa data frame together and convert from English to metric
noaa = merge(noaaprcp, noaatemp, all=T) %>%
  dplyr::select(-NAME, -STATION) %>%
  mutate(prec_mm = PRCP*25.4,
         tmin_c = (TMIN-32)*5/9,
         tmax_c = (TMAX-32)*5/9)

# separate date parts
jrn$year = lubridate::year(jrn$date)
jrn$month = lubridate::month(jrn$date)
jrn$day = lubridate::day(jrn$date)
prism$year = as.numeric(substr(prism$Date, 1,4))
prism$month = as.numeric(substr(prism$Date, 6,7))
noaa$year = lubridate::year(noaa$DATE)
noaa$month = lubridate::month(noaa$DATE)
noaa$day = lubridate::day(noaa$DATE)

# add column of data source
jrn$source = 'JRN'
noaa$source = 'NOAA'
prism$source = 'PRISM'
```

## temperature trends

There are three versions of climate data: PRISM (prism.oregonstate.edu), NOAA, and the JRN climate data from the headquarters station. 

JRN temperature trends:


```{r jrn station, echo=F}
# plot avg summer and winter high/low temp

jrn_summer_temp = dplyr::filter(jrn, month %in% c(6,7,8)) %>%
  group_by(year) %>%
  summarize(tmax_summer_avg = mean(tmax_c, na.rm=T),
            tmin_summer_avg = mean(tmin_c, na.rm=T),
            monthly_temp_nas = sum(is.na(tmax_c)),
            monthly_min_nas = sum(is.na(tmin_c))) %>%
  dplyr::filter(monthly_temp_nas<30, monthly_min_nas<30)

summer_max=ggplot(jrn_summer_temp, aes(x=year, y=tmax_summer_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily high temp June-August') +
  xlab('') +
  theme_bw()

summer_min=ggplot(jrn_summer_temp, aes(x=year, y=tmin_summer_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily low temp June-August') +
  xlab('') +
  theme_bw()

jrn_winter_temp = dplyr::filter(jrn, month %in% c(1,2)) %>%
  group_by(year) %>%
  summarize(tmax_winter_avg = mean(tmax_c, na.rm=T),
            tmin_winter_avg = mean(tmin_c, na.rm=T),
            monthly_temp_nas = sum(is.na(tmax_c)),
            monthly_min_nas = sum(is.na(tmin_c))) %>%
  dplyr::filter(monthly_temp_nas<20, monthly_min_nas<20)

winter_max=ggplot(jrn_winter_temp, aes(x=year, y=tmax_winter_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily high temp Jan-Feb') +
  xlab('') +
  theme_bw()

winter_min=ggplot(jrn_winter_temp, aes(x=year, y=tmin_winter_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily low temp Jan-Feb') +
  xlab('') +
  theme_bw()

gridExtra::grid.arrange(summer_max, summer_min, winter_max, winter_min, nrow=2)
```
NOAA data:

```{r noaa station, echo=F}
# plot avg summer and winter high/low temp

noaa_summer_temp = dplyr::filter(noaa, month %in% c(6,7,8)) %>%
  group_by(year) %>%
  summarize(tmax_summer_avg = mean(tmax_c, na.rm=T),
            tmin_summer_avg = mean(tmin_c, na.rm=T),
            monthly_temp_nas = sum(is.na(tmax_c)),
            monthly_min_nas = sum(is.na(tmin_c))) %>%
  dplyr::filter(monthly_temp_nas<30, monthly_min_nas<30)

summer_max2=ggplot(noaa_summer_temp, aes(x=year, y=tmax_summer_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily high temp June-August') +
  xlab('') +
  theme_bw()

summer_min2=ggplot(noaa_summer_temp, aes(x=year, y=tmin_summer_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily low temp June-August') +
  xlab('') +
  theme_bw()

noaa_winter_temp = dplyr::filter(noaa, month %in% c(1,2)) %>%
  group_by(year) %>%
  summarize(tmax_winter_avg = mean(tmax_c, na.rm=T),
            tmin_winter_avg = mean(tmin_c, na.rm=T),
            monthly_temp_nas = sum(is.na(tmax_c)),
            monthly_min_nas = sum(is.na(tmin_c))) %>%
  dplyr::filter(monthly_temp_nas<20, monthly_min_nas<20)

winter_max2=ggplot(noaa_winter_temp, aes(x=year, y=tmax_winter_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily high temp Jan-Feb') +
  xlab('') +
  theme_bw()

winter_min2=ggplot(noaa_winter_temp, aes(x=year, y=tmin_winter_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily low temp Jan-Feb') +
  xlab('') +
  theme_bw()

gridExtra::grid.arrange(summer_max2, summer_min2, winter_max2, winter_min2, nrow=2)
```

PRISM data:

```{r prism, echo=F}
# plot avg summer and winter high/low temp

prism_summer_temp = dplyr::filter(prism, month %in% c(6,7,8)) %>%
  group_by(year) %>%
  summarize(tmax_summer_avg = mean(tmax..degrees.C., na.rm=T),
            tmin_summer_avg = mean(tmin..degrees.C., na.rm=T)) 

summer_max=ggplot(prism_summer_temp, aes(x=year, y=tmax_summer_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily high temp June-August') +
  xlab('') +
  theme_bw()

summer_min=ggplot(prism_summer_temp, aes(x=year, y=tmin_summer_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily low temp June-August') +
  xlab('') +
  theme_bw()

prism_winter_temp = dplyr::filter(prism, month %in% c(1,2)) %>%
  group_by(year) %>%
  summarize(tmax_winter_avg = mean(tmax..degrees.C., na.rm=T),
            tmin_winter_avg = mean(tmin..degrees.C., na.rm=T)) 

winter_max=ggplot(prism_winter_temp, aes(x=year, y=tmax_winter_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily high temp Jan-Feb') +
  xlab('') +
  theme_bw()

winter_min=ggplot(prism_winter_temp, aes(x=year, y=tmin_winter_avg)) +
  geom_point() +
  geom_line() +
  ggtitle('Avg daily low temp Jan-Feb') +
  xlab('') +
  theme_bw()

gridExtra::grid.arrange(summer_max, summer_min, winter_max, winter_min, nrow=2)
```



